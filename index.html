<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Relational Spatial Database Design</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="designing-a-relational-database-for-spatial-querying-using-postgressql-with-postgis">Designing a Relational Database for Spatial Querying using PostgresSQL with PostGIS</h1>
<h5 id="by-tom-mckeon">by Tom McKeon</h5>
<p><img src="https://github.com/mckeonttemple/images/blob/gh-pages/cover.png?raw=true" alt="enter image description here"></p>
<h3 id="this-tutorial-is-meant-to-provide-an-example-of-how-to-design-a-relational-spatial-database-for-spatial-querying-through-the-use-of-freely-available-resources.-all-you-will-need-is-a-computer-an-internet-connection-and-some-patience."><strong>This tutorial is meant to provide an example of how to design a relational spatial database for spatial querying through the use of freely available resources. All you will need is a computer, an internet connection, and some patience.</strong></h3>
<p>In this exercise, you will learn how to use point-level data from the US- EPA’s Toxic Release Inventory Program ( TRI ) and join it by spatial location to polygon-level data of census tract boundaries from <a href="http://census.gov">census.gov</a>.</p>
<p>QGIS and DBeaver can be used to manage the data. LucidCharts can help us easily sketch an Entity-Relationship Diagram. PostgresSQL with the PostGIS extension will be used to write code to process and analyze these data.</p>
<p>The TRI  Program contains information about chemical releases from industrial and federal facilities.  The data contains information about toxic releases with the following attributes:</p>
<ul>
<li>Facility name, address, latitude and longitude coordinates, and industry sector codes</li>
<li>Chemical identification and classification information</li>
<li>Quantities of chemicals released on site at the facility</li>
<li>Quantities of chemicals transferred to Publicly Owned Treatment Works (POTWs)</li>
<li>Quantities of chemicals transferred off site to other locations for release/disposal and further waste management</li>
<li>Quantities of chemicals managed through disposal, energy recovery, recycling and treatment; non-production-related waste quantities; production/activity ratio</li>
</ul>
<p>You can further review documentation about the TRI attributes  here:</p>
<blockquote>
<p><a href="https://www.epa.gov/toxics-release-inventory-tri-program/tri-basic-data-files-guide">https://www.epa.gov/toxics-release-inventory-tri-program/tri-basic-data-files-guide</a></p>
</blockquote>
<h2 id="lets-get-to-it">Let’s get to it!</h2>
<p>Start by downloading annual .csv data files for Pennsylvania years 1987 to 2019 using the following link:</p>
<blockquote>
<p><a href="https://www.epa.gov/toxics-release-inventory-tri-program/tri-basic-data-files-calendar-years-19872018">https://www.epa.gov/toxics-release-inventory-tri-program/tri-basic-data-files-calendar-years-19872018</a></p>
</blockquote>
<p>Once downloaded, open Command Prompt and go to the folder where all the .csv files were downloaded.  Make sure all the .csv files are downloaded into the same folder.  Once you’re in the correct folder path, use the following code to combine all the .csv files into one named <strong>TRI_PA_1987_2018_all_zips.csv</strong></p>
<pre><code>copy *.csv TRI_PA_1987_2018_all_zips.csv
</code></pre>
<p>Next you will need to download QGIS, a freely available geographic information system, downloadable here:</p>
<blockquote>
<p><a href="https://qgis.org/en/site/forusers/download.html">https://qgis.org/en/site/forusers/download.html</a></p>
</blockquote>
<p>QGIS will allow us to convert <strong>TRI_PA_1987_2018_all_zips.csv</strong> into a data format with queryable spatial geometries. This can be done  by invoking the following commands:</p>
<p><strong>Add Vector Layer</strong>  &gt; <strong>Add Delimited Text Layer</strong> &gt;&gt; import .csv file and designate it as  <strong>Point Coordinates</strong> under the <strong>Geometry Definition</strong> section.</p>
<p>Once completed,  you should now see a visualization of all 143,436 points in this Pennsylvania TRI dataset:<br>
<img src="https://github.com/mckeonttemple/images/blob/gh-pages/tri_mark2.png?raw=true" alt="enter image description here"><br>
Repeat the above QGIS step with Pennsylvania census tract data. You have the option of importing a Shapefile instead of a .csv file using the following link:</p>
<blockquote>
<p><a href="https://catalog.data.gov/dataset/tiger-line-shapefile-2016-state-pennsylvania-current-census-tract-state-based">https://catalog.data.gov/dataset/tiger-line-shapefile-2016-state-pennsylvania-current-census-tract-state-based</a>.</p>
</blockquote>
<p>A shapefile is a common spatial data format which you may encounter when working with other datasets.  If you download the shapefile, you will have a zipped folder containing several files. Keep this folder  zipped.  In QGIS go to <strong>Add Vector Layer</strong>  &gt; browse for the zipped folder, select it, and import it.</p>
<p>Once completed, you should see the 3,218 census tracts which make up Pennsylvania.</p>
<p><img src="https://github.com/mckeonttemple/images/blob/gh-pages/pa_census_tracts.png?raw=true" alt="enter image description here"></p>
<pre class=" language-sql"><code class="prism  language-sql">A snippet preview <span class="token keyword">of</span> the PA Census Tract <span class="token keyword">data</span>:
id  <span class="token operator">|</span>geom                                                                                                                                                                                                                                                           <span class="token operator">|</span>statefp<span class="token operator">|</span>countyfp<span class="token operator">|</span>tractce<span class="token operator">|</span>geoid      <span class="token operator">|</span>name   <span class="token operator">|</span>namelsad            <span class="token operator">|</span>mtfcc<span class="token operator">|</span>funcstat<span class="token operator">|</span>aland    <span class="token operator">|</span>awater  <span class="token operator">|</span>intptlat   <span class="token operator">|</span>intptlon    <span class="token operator">|</span>
<span class="token comment">----|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------|--------|-------|-----------|-------|--------------------|-----|--------|---------|--------|-----------|------------|</span>
   <span class="token number">1</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">74.98425399999999</span> <span class="token number">40.055901999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.983544</span> <span class="token number">40.056663</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.982891</span> <span class="token number">40.057351</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.982569</span> <span class="token number">40.057666999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.982286</span> <span class="token number">40.057925999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.981601</span> <span class="token number">40.058493999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.980903</span> <span class="token number">40.059005</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.980683</span> <span class="token number">40.059152</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.98013999999999</span> <span class="token operator">|</span><span class="token number">42</span>     <span class="token operator">|</span><span class="token number">017</span>     <span class="token operator">|</span><span class="token number">100102</span> <span class="token operator">|</span><span class="token number">42017100102</span><span class="token operator">|</span><span class="token number">1001.02</span><span class="token operator">|</span>Census Tract <span class="token number">1001.02</span><span class="token operator">|</span>G5020<span class="token operator">|</span>S       <span class="token operator">|</span>  <span class="token number">7608630</span><span class="token operator">|</span> <span class="token number">2509728</span><span class="token operator">|</span><span class="token operator">+</span><span class="token number">40.0745595</span><span class="token operator">|</span><span class="token operator">-</span><span class="token number">074.9405810</span><span class="token operator">|</span>
   <span class="token number">6</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">74.96746</span> <span class="token number">40.131251</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.96718899999999</span> <span class="token number">40.131606</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.96663699999999</span> <span class="token number">40.132369</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.966507</span> <span class="token number">40.13254</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.966471</span> <span class="token number">40.132587</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.96624299999999</span> <span class="token number">40.132886</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.96600099999999</span> <span class="token number">40.133176</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.965823</span> <span class="token number">40.133415</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.965548</span> <span class="token number">40.133722999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7</span><span class="token operator">|</span><span class="token number">42</span>     <span class="token operator">|</span><span class="token number">017</span>     <span class="token operator">|</span><span class="token number">100206</span> <span class="token operator">|</span><span class="token number">42017100206</span><span class="token operator">|</span><span class="token number">1002.06</span><span class="token operator">|</span>Census Tract <span class="token number">1002.06</span><span class="token operator">|</span>G5020<span class="token operator">|</span>S       <span class="token operator">|</span>  <span class="token number">4735309</span><span class="token operator">|</span>       <span class="token number">0</span><span class="token operator">|</span><span class="token operator">+</span><span class="token number">40.1347795</span><span class="token operator">|</span><span class="token operator">-</span><span class="token number">074.9441709</span><span class="token operator">|</span>
   <span class="token number">2</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">74.984893</span> <span class="token number">40.057286999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.984805</span> <span class="token number">40.057399</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.984365</span> <span class="token number">40.057736999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.984129</span> <span class="token number">40.057837</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.98387</span> <span class="token number">40.057947999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.98331</span> <span class="token number">40.058187</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.98301699999999</span> <span class="token number">40.058367</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.9829</span> <span class="token number">40.058367</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.982372</span> <span class="token number">40.058682999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">|</span><span class="token number">42</span>     <span class="token operator">|</span><span class="token number">017</span>     <span class="token operator">|</span><span class="token number">100103</span> <span class="token operator">|</span><span class="token number">42017100103</span><span class="token operator">|</span><span class="token number">1001.03</span><span class="token operator">|</span>Census Tract <span class="token number">1001.03</span><span class="token operator">|</span>G5020<span class="token operator">|</span>S       <span class="token operator">|</span>  <span class="token number">1572548</span><span class="token operator">|</span>    <span class="token number">9817</span><span class="token operator">|</span><span class="token operator">+</span><span class="token number">40.0687610</span><span class="token operator">|</span><span class="token operator">-</span><span class="token number">074.9713318</span><span class="token operator">|</span>
   <span class="token number">3</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.233139</span> <span class="token number">40.150928</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.23261</span> <span class="token number">40.151449</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.232201</span> <span class="token number">40.151854</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.230049</span> <span class="token number">40.153973</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.229694</span> <span class="token number">40.154326</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.228445</span> <span class="token number">40.155557</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.22841799999999</span> <span class="token number">40.155584999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.227924</span> <span class="token number">40.156071999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.227836</span> <span class="token number">40.15616</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.22782</span> <span class="token number">40.1561</span><span class="token operator">|</span><span class="token number">42</span>     <span class="token operator">|</span><span class="token number">091</span>     <span class="token operator">|</span><span class="token number">201411</span> <span class="token operator">|</span><span class="token number">42091201411</span><span class="token operator">|</span><span class="token number">2014.11</span><span class="token operator">|</span>Census Tract <span class="token number">2014.11</span><span class="token operator">|</span>G5020<span class="token operator">|</span>S       <span class="token operator">|</span>  <span class="token number">2409072</span><span class="token operator">|</span>   <span class="token number">35484</span><span class="token operator">|</span><span class="token operator">+</span><span class="token number">40.1444849</span><span class="token operator">|</span><span class="token operator">-</span><span class="token number">075.2140269</span><span class="token operator">|</span>
  <span class="token number">46</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.72778</span> <span class="token number">40.41274</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.72746699999999</span> <span class="token number">40.412867999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.727279</span> <span class="token number">40.41317</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.727205</span> <span class="token number">40.413575</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.727104</span> <span class="token number">40.413636</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.727079</span> <span class="token number">40.41377</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.72690899999999</span> <span class="token number">40.413961</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.72645</span> <span class="token number">40.414232</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.72531</span> <span class="token number">40.414514</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.724991</span> <span class="token number">40.414522</span><span class="token punctuation">,</span> <span class="token operator">|</span><span class="token number">42</span>     <span class="token operator">|</span><span class="token number">129</span>     <span class="token operator">|</span><span class="token number">802103</span> <span class="token operator">|</span><span class="token number">42129802103</span><span class="token operator">|</span><span class="token number">8021.03</span><span class="token operator">|</span>Census Tract <span class="token number">8021.03</span><span class="token operator">|</span>G5020<span class="token operator">|</span>S       <span class="token operator">|</span> <span class="token number">13216699</span><span class="token operator">|</span>       <span class="token number">0</span><span class="token operator">|</span><span class="token operator">+</span><span class="token number">40.4111529</span><span class="token operator">|</span><span class="token operator">-</span><span class="token number">079.6840287</span><span class="token operator">|</span>
  <span class="token number">47</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.55927899999999</span> <span class="token number">40.181917</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.559148</span> <span class="token number">40.182455</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.559111</span> <span class="token number">40.182573999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.558984</span> <span class="token number">40.182984</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.558871</span> <span class="token number">40.183202</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.558652</span> <span class="token number">40.183623</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.55854</span> <span class="token number">40.184027</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.558376</span> <span class="token number">40.184619999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.558155</span> <span class="token number">40.185418999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.557</span><span class="token operator">|</span><span class="token number">42</span>     <span class="token operator">|</span><span class="token number">129</span>     <span class="token operator">|</span><span class="token number">806900</span> <span class="token operator">|</span><span class="token number">42129806900</span><span class="token operator">|</span><span class="token number">8069</span>   <span class="token operator">|</span>Census Tract <span class="token number">8069</span>   <span class="token operator">|</span>G5020<span class="token operator">|</span>S       <span class="token operator">|</span> <span class="token number">26895523</span><span class="token operator">|</span>   <span class="token number">96851</span><span class="token operator">|</span><span class="token operator">+</span><span class="token number">40.1608151</span><span class="token operator">|</span><span class="token operator">-</span><span class="token number">079.5207125</span><span class="token operator">|</span>
  <span class="token number">48</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.57240999999999</span> <span class="token number">40.239598</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.572243</span> <span class="token number">40.23965</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.57195399999999</span> <span class="token number">40.239644999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.570971</span> <span class="token number">40.23963</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.570889</span> <span class="token number">40.239613999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.57022599999999</span> <span class="token number">40.239357</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.57019799999999</span> <span class="token number">40.239464999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.57000099999999</span> <span class="token number">40.240206</span><span class="token operator">|</span><span class="token number">42</span>     <span class="token operator">|</span><span class="token number">129</span>     <span class="token operator">|</span><span class="token number">804501</span> <span class="token operator">|</span><span class="token number">42129804501</span><span class="token operator">|</span><span class="token number">8045.01</span><span class="token operator">|</span>Census Tract <span class="token number">8045.01</span><span class="token operator">|</span>G5020<span class="token operator">|</span>S       <span class="token operator">|</span> <span class="token number">17597811</span><span class="token operator">|</span>       <span class="token number">0</span><span class="token operator">|</span><span class="token operator">+</span><span class="token number">40.2550632</span><span class="token operator">|</span><span class="token operator">-</span><span class="token number">079.5425163</span><span class="token operator">|</span>
   <span class="token number">4</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">74.964883</span> <span class="token number">40.077273</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.96455499999999</span> <span class="token number">40.077227</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.96452599999999</span> <span class="token number">40.077223</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.964409</span> <span class="token number">40.077207</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.964231</span> <span class="token number">40.077217999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.963787</span> <span class="token number">40.077295</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.963459</span> <span class="token number">40.077411</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.96273699999999</span> <span class="token number">40.077839</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.962465</span> <span class="token number">40.078075</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.9623</span><span class="token operator">|</span><span class="token number">42</span>     <span class="token operator">|</span><span class="token number">017</span>     <span class="token operator">|</span><span class="token number">100104</span> <span class="token operator">|</span><span class="token number">42017100104</span><span class="token operator">|</span><span class="token number">1001.04</span><span class="token operator">|</span>Census Tract <span class="token number">1001.04</span><span class="token operator">|</span>G5020<span class="token operator">|</span>S       <span class="token operator">|</span>  <span class="token number">1966895</span><span class="token operator">|</span>   <span class="token number">12199</span><span class="token operator">|</span><span class="token operator">+</span><span class="token number">40.0918428</span><span class="token operator">|</span><span class="token operator">-</span><span class="token number">074.9501748</span><span class="token operator">|</span>
</code></pre>
<p>Next setup DBeaver, a SQL client and database administration tool which we will use to manage the TRI data and create entity-relationship tables.  DBeaver is freely available through the following link:  <a href="http://dbeaver.io">dbeaver.io</a>.</p>
<p>Once DBeaver is setup, create a new database connection to PostgresSQL. PostgreSQL is a powerful open source object-relational database system which uses SQL as its coding language.  The first thing you’ll want to do is add the PostGIS extension. PostGIS is an open source software program that adds support for geographic objects to the PostgreSQL object-relational database.</p>
<p>To do this, type the following code into DBeaver’s text editor:</p>
<pre class=" language-sql"><code class="prism  language-sql"><span class="token keyword">create</span> extension postgis<span class="token punctuation">;</span>
</code></pre>
<p>You can read more about PostGIS functions here:</p>
<blockquote>
<p><a href="http://postgis.net/workshops/postgis-intro/">postgis.net/workshops/postgis-intro/</a></p>
</blockquote>
<p>Great! Next we’ll want to connect our newly created spatial data, stored in QGIS to DBeaver.</p>
<p>In order to do this, a new schema needs to first be created in DBeaver. Do this by right-clicking in the database navigator and choosing <strong>create</strong> &gt; <strong>schema</strong> then naming it something relevant. Once created, go back to QGIS and connect to the schema by connecting to DB Manager under the database tab. You should now have your data in DBeaver.</p>
<p>Next, we will have to normalize our  data. The data comes with over 110 fields, many of which can be calculated through spatial querying.  For this tutorial, the TRI data was normalized into five entity-relationship tables, each containing a primary key for unique entries, as well as foriegn keys to connect to other tables’ primary keys. <a href="http://lucidchart.com">lucidchart.com</a> can be used to diagram these tables. The list below describes these tables in further detail.</p>
<ol>
<li><strong>Facility</strong>: Contains facility location information,  geometries, address, name, and TRI emission identifier.</li>
<li><strong>Company</strong>: Contains parent company information, NAICS and SIC information.</li>
<li><strong>Release</strong>: Contains emission release quantity, unit of measure, year, industry code, and form type.</li>
<li><strong>Chemical</strong>: Contains information about the chemical released such as its classifcation, carcinogen status, metal status, clean air act chemical status, and cas compound identifier.</li>
<li><strong>Type</strong>:  Contains information about the type of release such as air, water, underground, and surface.</li>
</ol>
<p>The following image shows and Entity-Relationship-Diagram (ERD) of how the tables are connected. The entity connections use a crows feet convention, which can be further reviewed in <a href="http://lucidchart.com">lucidchart.com</a>.</p>
<p><img src="https://github.com/mckeonttemple/images/blob/gh-pages/ERD_McKeon.png?raw=true" alt="enter image description here"></p>
<h2 id="creating-tables-in-dbeaver">Creating Tables in DBeaver</h2>
<p>The following SQL script inputs the tables described above into DBeaver. Once created, we are ready to begin asking our spatial queries!</p>
<pre class=" language-sql"><code class="prism  language-sql"><span class="token comment">-- set the path and rename the tri table</span>
<span class="token keyword">set</span> search_path <span class="token keyword">to</span> tri_pa_1987_2018<span class="token punctuation">,</span> <span class="token keyword">public</span><span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> tri_pa_1987_2018<span class="token punctuation">.</span><span class="token string">"TRI_PA_1987_2018_all_zips"</span>
<span class="token keyword">rename</span> <span class="token keyword">to</span> tri_pa_1987_2018<span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> 
<span class="token keyword">from</span> tri_pa_1987_2018<span class="token punctuation">;</span>

<span class="token comment">--create the company table</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> company <span class="token keyword">cascade</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> company <span class="token punctuation">(</span>
  company_id <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  parent_co_name <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  parent_co_db_num <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  primary_naics <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  naics2 <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  naics3 <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  naics4 <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  naics5 <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  naics6 <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  primary_sic <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  sic2 <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  sic3 <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  sic4 <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  sic5 <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  sic6 <span class="token keyword">varchar</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token keyword">insert</span> <span class="token keyword">into</span> company <span class="token punctuation">(</span>parent_co_name<span class="token punctuation">,</span> 
parent_co_db_num<span class="token punctuation">,</span> primary_naics<span class="token punctuation">,</span> naics2<span class="token punctuation">,</span> naics3<span class="token punctuation">,</span> naics4<span class="token punctuation">,</span> 
naics5<span class="token punctuation">,</span> naics6<span class="token punctuation">,</span> primary_sic<span class="token punctuation">,</span> sic2<span class="token punctuation">,</span> sic3<span class="token punctuation">,</span> sic4<span class="token punctuation">,</span> sic5<span class="token punctuation">,</span> sic6<span class="token punctuation">)</span>
<span class="token keyword">select</span>
<span class="token keyword">distinct</span> <span class="token string">"112. parent co name"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"113. parent co db num"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"23. primary naics"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"24. naics 2"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"25. naics 3"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"26. naics 4"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"27. naics 5"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span>
<span class="token string">"28. naics 6"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"17. primary sic"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"18. sic 2"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span>
<span class="token string">"19. sic 3"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span>
<span class="token string">"20. sic 4"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"21. sic 5"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"22. sic 6"</span> :: <span class="token keyword">varchar</span>
<span class="token keyword">from</span> tri_pa_1987_2018<span class="token punctuation">;</span>

<span class="token comment">--create the facility table</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> facility <span class="token keyword">cascade</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> facility <span class="token punctuation">(</span>
  trifd <span class="token keyword">varchar</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  facility_name <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  federal_facility <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  street_address <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  city <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  county <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  st <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  zip <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  geom <span class="token keyword">geometry</span><span class="token punctuation">,</span>
  company_id <span class="token keyword">int</span> <span class="token keyword">references</span> company <span class="token punctuation">(</span>company_id<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token keyword">insert</span> <span class="token keyword">into</span> facility <span class="token punctuation">(</span>trifd<span class="token punctuation">,</span> facility_name<span class="token punctuation">,</span> 
federal_facility<span class="token punctuation">,</span> street_address<span class="token punctuation">,</span> city<span class="token punctuation">,</span> 
county<span class="token punctuation">,</span> st<span class="token punctuation">,</span> zip<span class="token punctuation">,</span> geom<span class="token punctuation">,</span> company_id<span class="token punctuation">)</span>
<span class="token keyword">select</span>
<span class="token keyword">distinct</span> <span class="token string">"2. trifd"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"4. facility name"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"14. federal facility"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span>
<span class="token string">"5. street address"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"6. city"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"7. county"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"8. st"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"9. zip"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
geom :: <span class="token keyword">geometry</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token keyword">select</span> company_id
  <span class="token keyword">from</span> company <span class="token keyword">as</span> <span class="token number">a</span>
   <span class="token keyword">where</span> <span class="token number">a</span><span class="token punctuation">.</span>parent_co_db_num <span class="token operator">=</span> <span class="token number">b</span><span class="token punctuation">.</span><span class="token string">"113. parent co db num"</span>
   <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> tri_pa_1987_2018 <span class="token keyword">as</span> <span class="token number">b</span><span class="token punctuation">;</span>


<span class="token comment">--create the chemical table</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> chemical <span class="token keyword">cascade</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> chemical <span class="token punctuation">(</span>
  chemical <span class="token keyword">varchar</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  srs_id <span class="token keyword">int</span><span class="token punctuation">,</span>
  classification <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  metal_category <span class="token keyword">int</span><span class="token punctuation">,</span>
  metal <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  carcinogen <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  cas_compound_id <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  clean_air_act_chemical <span class="token keyword">varchar</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token keyword">insert</span> <span class="token keyword">into</span> chemical <span class="token punctuation">(</span>chemical<span class="token punctuation">,</span> srs_id<span class="token punctuation">,</span> 
classification<span class="token punctuation">,</span> metal_category<span class="token punctuation">,</span> metal<span class="token punctuation">,</span>
carcinogen<span class="token punctuation">,</span> cas_compound_id<span class="token punctuation">,</span> clean_air_act_chemical <span class="token punctuation">)</span>
<span class="token keyword">select</span>
<span class="token keyword">distinct</span> <span class="token string">"30. chemical"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"32. srs id"</span> :: <span class="token keyword">int</span><span class="token punctuation">,</span> 
<span class="token string">"34. classification"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"36. metal category"</span> :: <span class="token keyword">int</span><span class="token punctuation">,</span> 
<span class="token string">"35. metal"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"37. carcinogen"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"31. cas #/compound id"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"33. clean air act chemical"</span> :: <span class="token keyword">varchar</span>
<span class="token keyword">from</span> tri_pa_1987_2018<span class="token punctuation">;</span>


<span class="token comment">--create the release table</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> <span class="token keyword">release</span> <span class="token keyword">cascade</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">release</span> <span class="token punctuation">(</span>
  release_id <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  year <span class="token keyword">int</span><span class="token punctuation">,</span>
  quantity <span class="token keyword">int</span><span class="token punctuation">,</span>
  unit_of_measure <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  industry_sector_code <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  industry_sector <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  form_type <span class="token keyword">varchar</span><span class="token punctuation">,</span>
  trifd <span class="token keyword">varchar</span> <span class="token keyword">references</span> facility <span class="token punctuation">(</span>trifd<span class="token punctuation">)</span><span class="token punctuation">,</span>
  chemical <span class="token keyword">varchar</span> <span class="token keyword">references</span> chemical <span class="token punctuation">(</span>chemical<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">release</span> <span class="token punctuation">(</span>year<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> 
unit_of_measure<span class="token punctuation">,</span> industry_sector_code<span class="token punctuation">,</span> 
industry_sector<span class="token punctuation">,</span> form_type<span class="token punctuation">,</span> trifd<span class="token punctuation">,</span> chemical<span class="token punctuation">)</span>
<span class="token keyword">select</span>
<span class="token keyword">distinct</span>  <span class="token string">"1. year"</span> :: <span class="token keyword">int</span><span class="token punctuation">,</span> 
<span class="token string">"54. on-site release total"</span> :: <span class="token keyword">int</span><span class="token punctuation">,</span> 
<span class="token string">"39. unit of measure"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"15. industry sector code"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"16. industry sector"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"38. form type"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"2. trifd"</span> :: <span class="token keyword">varchar</span><span class="token punctuation">,</span> 
<span class="token string">"30. chemical"</span> :: <span class="token keyword">varchar</span>
<span class="token keyword">from</span> tri_pa_1987_2018<span class="token punctuation">;</span>

<span class="token comment">--create the type table</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> <span class="token keyword">type</span> <span class="token keyword">cascade</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">type</span> <span class="token punctuation">(</span>
  type_id <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  fugitive_air <span class="token keyword">float</span><span class="token punctuation">,</span>
  stack_air <span class="token keyword">float</span><span class="token punctuation">,</span>
  water <span class="token keyword">float</span><span class="token punctuation">,</span>
  other_landfills <span class="token keyword">float</span><span class="token punctuation">,</span>
  rcra_c_landfill <span class="token keyword">float</span><span class="token punctuation">,</span>
  land_treatment <span class="token keyword">float</span><span class="token punctuation">,</span>
  surface_impendmnt <span class="token keyword">float</span><span class="token punctuation">,</span>
  rcra_surface_im <span class="token keyword">float</span><span class="token punctuation">,</span>
  other_surface <span class="token keyword">float</span><span class="token punctuation">,</span>
  other_disposal <span class="token keyword">float</span><span class="token punctuation">,</span>
  underground <span class="token keyword">int</span><span class="token punctuation">,</span>
  underground_cl_l <span class="token keyword">float</span><span class="token punctuation">,</span>
  underground_c_ll_v <span class="token keyword">float</span><span class="token punctuation">,</span>
  release_id <span class="token keyword">serial</span> <span class="token keyword">references</span> <span class="token keyword">release</span> <span class="token punctuation">(</span>release_id<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">type</span> <span class="token punctuation">(</span>fugitive_air<span class="token punctuation">,</span> stack_air<span class="token punctuation">,</span> water<span class="token punctuation">,</span> 
other_landfills<span class="token punctuation">,</span> rcra_c_landfill<span class="token punctuation">,</span> land_treatment<span class="token punctuation">,</span> 
surface_impendmnt<span class="token punctuation">,</span> rcra_surface_im<span class="token punctuation">,</span> other_surface<span class="token punctuation">,</span> 
other_disposal<span class="token punctuation">,</span> underground<span class="token punctuation">,</span> underground_cl_l<span class="token punctuation">,</span> 
underground_c_ll_v<span class="token punctuation">,</span> release_id <span class="token punctuation">)</span>
<span class="token keyword">select</span>
<span class="token keyword">distinct</span> <span class="token string">"40. 5.1 - fugitive air"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span> 
<span class="token string">"41. 5.2 - stack air"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span> 
<span class="token string">"42. 5.3 - water"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span> 
<span class="token string">"48. 5.5.1b - other landfills"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span> 
<span class="token string">"47. 5.5.1a - rcra c landfill"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span> 
<span class="token string">"49. 5.5.2 - land treatment"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span> 
<span class="token string">"50. 5.5.3 - surface impndmnt"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span>
<span class="token string">"51. 5.5.3a - rcra surface im"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span> 
<span class="token string">"52. 5.5.3b - other surface i"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span> 
<span class="token string">"53. 5.5.4 - other disposal"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span>
<span class="token string">"43. 5.4 - underground"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span> 
<span class="token string">"44. 5.4.1 - underground cl i"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span> 
<span class="token string">"45. 5.4.2 - underground c ii-v"</span> :: <span class="token keyword">float</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> release_id
 <span class="token keyword">from</span> <span class="token keyword">release</span> <span class="token keyword">as</span> <span class="token number">a</span> 
  <span class="token keyword">where</span> <span class="token number">a</span><span class="token punctuation">.</span>trifd <span class="token operator">=</span> <span class="token number">b</span><span class="token punctuation">.</span><span class="token string">"2. trifd"</span>
  <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> tri_pa_1987_2018 <span class="token keyword">as</span> <span class="token number">b</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="spatial-queries">Spatial Queries</h2>
<h3 id="you-are-now-ready-to-ask-an-endless-amount-of-spatial-queries.-work-through-the-following-four-examples.-once-completed-read-through-the--postgis-documentation-and-try-out-new-functions-to-play-around-with-your-own-queries">You are now ready to ask an endless amount of spatial queries. Work through the following four examples. Once completed, read through the  PostGIS documentation and try out new functions to play around with your own queries!</h3>
<h5 id="postgis-functions-for-spatial-relationships-httpsweb.archive.orgweb20170913113302httpworkshops.boundlessgeo.compostgis-introspatial_relationships.html">PostGIS Functions for Spatial Relationships: <a href="https://web.archive.org/web/20170913113302/http://workshops.boundlessgeo.com/postgis-intro/spatial_relationships.html">https://web.archive.org/web/20170913113302/http://workshops.boundlessgeo.com/postgis-intro/spatial_relationships.html</a></h5>
<p><strong>Spatial Query 1</strong>:<br>
<em><strong>For the year 1990, what chemicals in which census tracts, along with their TRIFD identifier, reported their max emission as greater than 1,000,000?</strong></em></p>
<p>Use the facility and release tables to join to the Census Tract table. Think about how to select chemical names, TRI emission identifiers ( trifd),  corresponding PA census tract, year, and emissions.</p>
<p>You will want to use an aggegrate function to choose the max emissions.  Fortunately, we designed these tables to be relational.  Join the facility table, which contains information about the facility’s location to the release table which contains information about the emission. This join can be done by the trifd field which is the primary key of the facility table, and the foreign key of the release table.</p>
<p>Next join to the census tract table by using a PostGIS function:  <em>ST_Intersects</em> .</p>
<pre class=" language-sql"><code class="prism  language-sql"><span class="token keyword">join</span> tl_2016_42_tract
  <span class="token keyword">on</span> ST_Intersects<span class="token punctuation">(</span>ST_Transform<span class="token punctuation">(</span>tl_2016_42_tract<span class="token punctuation">.</span>geom<span class="token punctuation">,</span> <span class="token number">4326</span><span class="token punctuation">)</span> 
     :: geography<span class="token punctuation">,</span> facility<span class="token punctuation">.</span>geom<span class="token punctuation">)</span>
</code></pre>
<p>This allows for a join by spatial location of the TRI points which intersect to each census tract polygon.  Oftentimes, you may recieve spatial data with differing projection systems. <em>The ST_SRID(geom)</em> function allows us to check the geographic projection of each layer.</p>
<pre class=" language-sql"><code class="prism  language-sql"><span class="token keyword">select</span> st_srid<span class="token punctuation">(</span>geom<span class="token punctuation">)</span>
<span class="token keyword">from</span> tl_2016_42_tract<span class="token punctuation">;</span>

st_srid<span class="token operator">|</span>
<span class="token comment">-------|</span>
   <span class="token number">4269</span><span class="token operator">|</span>
</code></pre>
<pre class=" language-sql"><code class="prism  language-sql"><span class="token keyword">select</span> st_srid<span class="token punctuation">(</span>geom<span class="token punctuation">)</span>
<span class="token keyword">from</span> facility<span class="token punctuation">;</span>

st_srid<span class="token operator">|</span>
<span class="token comment">-------|</span>
   <span class="token number">4326</span><span class="token operator">|</span>
</code></pre>
<p>In our case, the The PA Census Tracts layer uses the SRID 4269 <a href="https://epsg.io/4269">https://epsg.io/4269</a> coordinate system.  The TRI data uses SRID 4326 <a href="https://epsg.io/4326">https://epsg.io/4326</a> coordinate system .  Since these projection systems differ, the geometry of the census tract layer has to be transformed to match the TRI facilities in order for this query to work, using the <em>ST_Transform</em> function. Try this out, then when you’re ready check your query to the completed code:</p>
<pre class=" language-sql"><code class="prism  language-sql"><span class="token keyword">select</span> <span class="token number">a</span><span class="token punctuation">.</span>trifd<span class="token punctuation">,</span> 
  <span class="token number">b</span><span class="token punctuation">.</span>chemical<span class="token punctuation">,</span> 
  <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">b</span><span class="token punctuation">.</span>quantity<span class="token punctuation">)</span> <span class="token keyword">as</span> max_emission_in_Census_Tract<span class="token punctuation">,</span> 
  <span class="token number">b</span><span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token number">c</span><span class="token punctuation">.</span>namelsad<span class="token punctuation">,</span> 
  <span class="token number">c</span><span class="token punctuation">.</span>geom <span class="token keyword">as</span> Census_Tract_Geometries<span class="token punctuation">,</span> 
  <span class="token number">a</span><span class="token punctuation">.</span>geom <span class="token keyword">as</span> TRI_Geometries
<span class="token keyword">from</span> facility <span class="token keyword">as</span> <span class="token number">a</span> 
<span class="token keyword">join</span> <span class="token keyword">release</span> <span class="token keyword">as</span> <span class="token number">b</span> 
  <span class="token keyword">on</span> <span class="token number">a</span><span class="token punctuation">.</span>trifd <span class="token operator">=</span> <span class="token number">b</span><span class="token punctuation">.</span>trifd
<span class="token keyword">join</span> 
 tl_2016_42_tract <span class="token keyword">as</span> <span class="token number">c</span> 
 <span class="token keyword">on</span> ST_Intersects<span class="token punctuation">(</span>ST_Transform<span class="token punctuation">(</span><span class="token number">c</span><span class="token punctuation">.</span>geom<span class="token punctuation">,</span> <span class="token number">4326</span><span class="token punctuation">)</span>
 :: geography<span class="token punctuation">,</span> <span class="token number">a</span><span class="token punctuation">.</span>geom<span class="token punctuation">)</span>
<span class="token keyword">where</span> <span class="token number">b</span><span class="token punctuation">.</span>year <span class="token operator">=</span> <span class="token number">1990</span> 
  <span class="token operator">and</span> <span class="token number">b</span><span class="token punctuation">.</span>quantity <span class="token operator">&gt;</span> <span class="token number">1000000</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token number">a</span><span class="token punctuation">.</span>trifd<span class="token punctuation">,</span> 
  <span class="token number">b</span><span class="token punctuation">.</span>chemical<span class="token punctuation">,</span> 
  <span class="token number">c</span><span class="token punctuation">.</span>namelsad<span class="token punctuation">,</span> 
  <span class="token number">b</span><span class="token punctuation">.</span>chemical<span class="token punctuation">,</span> 
  <span class="token number">b</span><span class="token punctuation">.</span>year<span class="token punctuation">,</span> 
  <span class="token number">c</span><span class="token punctuation">.</span>geom<span class="token punctuation">,</span> 
  <span class="token number">a</span><span class="token punctuation">.</span>geom<span class="token punctuation">;</span>
</code></pre>
<p>RESULT:</p>
<pre class=" language-sql"><code class="prism  language-sql">trifd          <span class="token operator">|</span>chemical             <span class="token operator">|</span>max_emission_in_census_tract<span class="token operator">|</span>year<span class="token operator">|</span>namelsad            <span class="token operator">|</span>census_tract_geometries                                                                                                                                                                                                                                        <span class="token operator">|</span>tri_geometries              <span class="token operator">|</span>
<span class="token comment">---------------|---------------------|----------------------------|----|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|</span>
15025SSCLR400ST<span class="token operator">|</span>AMMONIA              <span class="token operator">|</span>                     <span class="token number">1140000</span><span class="token operator">|</span><span class="token number">1990</span><span class="token operator">|</span>Census Tract <span class="token number">4927</span>   <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.90074299999999</span> <span class="token number">40.312036</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.90044499999999</span> <span class="token number">40.312205</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.90040499999999</span> <span class="token number">40.312239999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.900145</span> <span class="token number">40.312464</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.89992199999999</span> <span class="token number">40.312317</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.89967899999999</span> <span class="token number">40.312158</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.89958899999999</span> <span class="token number">40.312098999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.899351</span> <span class="token number">40.31232</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.876911</span> <span class="token number">40.305088</span><span class="token punctuation">)</span><span class="token operator">|</span>
15061ZNCCR300FR<span class="token operator">|</span>ZINC COMPOUNDS       <span class="token operator">|</span>                     <span class="token number">1310750</span><span class="token operator">|</span><span class="token number">1990</span><span class="token operator">|</span>Census Tract <span class="token number">6055</span>   <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80.39197999999999</span> <span class="token number">40.639486999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.39195099999999</span> <span class="token number">40.639528</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.39187799999999</span> <span class="token number">40.639572</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.391807</span> <span class="token number">40.639595</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.391533</span> <span class="token number">40.639629</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.391305</span> <span class="token number">40.639688</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.39120799999999</span> <span class="token number">40.639713</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.39100599999999</span> <span class="token number">40.639801999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.3</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80.3365</span> <span class="token number">40.67058</span><span class="token punctuation">)</span>   <span class="token operator">|</span>
15902JHNST545CE<span class="token operator">|</span>CHROMIUM             <span class="token operator">|</span>                     <span class="token number">1141510</span><span class="token operator">|</span><span class="token number">1990</span><span class="token operator">|</span>Census Tract <span class="token number">6</span>      <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.91914299999999</span> <span class="token number">40.295201999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.918798</span> <span class="token number">40.29609</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.918695</span> <span class="token number">40.296333</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.918284</span> <span class="token number">40.297312</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.91720699999999</span> <span class="token number">40.299655</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.916718</span> <span class="token number">40.300519</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.91613199999999</span> <span class="token number">40.301024</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.915487</span> <span class="token number">40.301612999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.914953</span> <span class="token number">40.30196199</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.91209</span> <span class="token number">40.29904</span><span class="token punctuation">)</span>  <span class="token operator">|</span>
16323FRNKL600AT<span class="token operator">|</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">-</span>TRICHLOROETHANE<span class="token operator">|</span>                     <span class="token number">1243000</span><span class="token operator">|</span><span class="token number">1990</span><span class="token operator">|</span>Census Tract <span class="token number">2003</span>   <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.87272</span> <span class="token number">41.40067</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.871202</span> <span class="token number">41.406532999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.870919</span> <span class="token number">41.406821</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.870499</span> <span class="token number">41.406797999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.867976</span> <span class="token number">41.406403</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.86777</span> <span class="token number">41.406501</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.867346</span> <span class="token number">41.407641</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.867266</span> <span class="token number">41.407624</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.867233</span> <span class="token number">41.407713</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.86740999999999</span> <span class="token number">41.4079</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.84519</span> <span class="token number">41.40324</span><span class="token punctuation">)</span>  <span class="token operator">|</span>
17601RRDNN216GR<span class="token operator">|</span>TOLUENE              <span class="token operator">|</span>                     <span class="token number">1182000</span><span class="token operator">|</span><span class="token number">1990</span><span class="token operator">|</span>Census Tract <span class="token number">132.02</span> <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76.27807299999999</span> <span class="token number">40.04969</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.277908</span> <span class="token number">40.049648999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.277908</span> <span class="token number">40.049667</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.277913</span> <span class="token number">40.04972</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.277906</span> <span class="token number">40.049807</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.277844</span> <span class="token number">40.049907</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.277816</span> <span class="token number">40.049983</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.277805</span> <span class="token number">40.050013</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.277784</span> <span class="token number">40.050098</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.277709</span> <span class="token number">40.050202999999</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76.26023</span> <span class="token number">40.04903</span><span class="token punctuation">)</span>  <span class="token operator">|</span>
18016BTHLH501EA<span class="token operator">|</span>ZINC COMPOUNDS       <span class="token operator">|</span>                     <span class="token number">1070600</span><span class="token operator">|</span><span class="token number">1990</span><span class="token operator">|</span>Census Tract <span class="token number">113</span>    <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.378625</span> <span class="token number">40.61529</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.3781</span> <span class="token number">40.615308999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.37562</span> <span class="token number">40.615398</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.375254</span> <span class="token number">40.615485</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.374757</span> <span class="token number">40.615603</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.37343899999999</span> <span class="token number">40.615915</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.372361</span> <span class="token number">40.616171</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.37182399999999</span> <span class="token number">40.616298</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.367705</span> <span class="token number">40.616479</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.36693199999999</span> <span class="token number">4</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.344902</span> <span class="token number">40.611803</span><span class="token punctuation">)</span><span class="token operator">|</span>
19007MCMPNGREEN<span class="token operator">|</span>TOLUENE              <span class="token operator">|</span>                     <span class="token number">1900250</span><span class="token operator">|</span><span class="token number">1990</span><span class="token operator">|</span>Census Tract <span class="token number">1004.03</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">74.860519</span> <span class="token number">40.124862</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.86049299999999</span> <span class="token number">40.125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.859884</span> <span class="token number">40.126311</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.859766</span> <span class="token number">40.126446</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.85966499999999</span> <span class="token number">40.126796</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.85952999999999</span> <span class="token number">40.127075999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.859529</span> <span class="token number">40.127345999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.85941199999999</span> <span class="token number">40.127435999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.859</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">74.852234</span> <span class="token number">40.12751</span><span class="token punctuation">)</span> <span class="token operator">|</span>
19030SSFRLMAILS<span class="token operator">|</span>MANGANESE COMPOUNDS  <span class="token operator">|</span>                     <span class="token number">7822200</span><span class="token operator">|</span><span class="token number">1990</span><span class="token operator">|</span>Census Tract <span class="token number">1058.09</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">74.859766</span> <span class="token number">40.175941</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.85810599999999</span> <span class="token number">40.176533</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.85605699999999</span> <span class="token number">40.177262999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.854479</span> <span class="token number">40.177827</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.85049699999999</span> <span class="token number">40.179249</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.849201</span> <span class="token number">40.179711999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.84846</span> <span class="token number">40.179978</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.84827299999999</span> <span class="token number">40.18005</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.847847</span> <span class="token number">40.1</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">74.850518</span> <span class="token number">40.17182</span><span class="token punctuation">)</span> <span class="token operator">|</span>
19137LLDSGMARGA<span class="token operator">|</span>CUMENE               <span class="token operator">|</span>                     <span class="token number">1053700</span><span class="token operator">|</span><span class="token number">1990</span><span class="token operator">|</span>Census Tract <span class="token number">184</span>    <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.075687</span> <span class="token number">40.005553</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.074677</span> <span class="token number">40.006358999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.073871</span> <span class="token number">40.006979</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.07369299999999</span> <span class="token number">40.007114</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.07340099999999</span> <span class="token number">40.007338</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.07328</span> <span class="token number">40.007436</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.07286599999999</span> <span class="token number">40.007771</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.072735</span> <span class="token number">40.007877</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.07270199999999</span> <span class="token number">40.007903999</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.072105</span> <span class="token number">40.003765</span><span class="token punctuation">)</span><span class="token operator">|</span>

</code></pre>
<p><img src="https://github.com/mckeonttemple/images/blob/gh-pages/SQ1_fullextent.png?raw=true" alt="enter image description here"><br>
<img src="https://github.com/mckeonttemple/images/blob/gh-pages/SQ1_zoomed.png?raw=true" alt="enter image description here"></p>
<p><strong>Spatial Query 2</strong>:<br>
<strong>List the census tracts which contain chemicals that are classified as a carcinogen and that emitted between 10,000 and 15,000 pounds for the year 2018.</strong></p>
<p>The second spatial query uses the facility, chemical, release, and PA Census Tracts tables.   In this query,  we’re interested in the names of the chemicals, their emission quantity between 10,000 and 15,000,  emission unit of measure, and census tract name, for emissions  which are classified as a carcinogen in the year 2018. This query requires identifying all the TRI points which intersect each census tract layer. Again, since these  projection systems were different, the geometry of the census tract layer had to be transformed to match the TRI facilities in order for this query to work.</p>
<pre class=" language-sql"><code class="prism  language-sql"><span class="token keyword">select</span> <span class="token number">a</span><span class="token punctuation">.</span>chemical<span class="token punctuation">,</span> 
  <span class="token number">a</span><span class="token punctuation">.</span>quantity<span class="token punctuation">,</span> 
  <span class="token number">a</span><span class="token punctuation">.</span>unit_of_measure<span class="token punctuation">,</span> 
  <span class="token number">d</span><span class="token punctuation">.</span>namelsad<span class="token punctuation">,</span> 
  <span class="token number">d</span><span class="token punctuation">.</span>geom <span class="token keyword">as</span> Census_Tract_Geometries<span class="token punctuation">,</span> 
  <span class="token number">c</span><span class="token punctuation">.</span>geom <span class="token keyword">as</span> TRI_Geometries
<span class="token keyword">from</span> <span class="token keyword">release</span> <span class="token keyword">as</span> <span class="token number">a</span> 
<span class="token keyword">join</span> chemical <span class="token keyword">as</span> <span class="token number">b</span> 
	<span class="token keyword">on</span> <span class="token number">a</span><span class="token punctuation">.</span>chemical <span class="token operator">=</span> <span class="token number">b</span><span class="token punctuation">.</span>chemical 
<span class="token keyword">join</span> facility <span class="token keyword">as</span> <span class="token number">c</span> 
	<span class="token keyword">on</span> <span class="token number">a</span><span class="token punctuation">.</span>trifd <span class="token operator">=</span> <span class="token number">c</span><span class="token punctuation">.</span>trifd 
<span class="token keyword">join</span>
   tl_2016_42_tract <span class="token keyword">as</span> <span class="token number">d</span>
   <span class="token keyword">on</span> ST_Intersects<span class="token punctuation">(</span>ST_Transform<span class="token punctuation">(</span><span class="token number">d</span><span class="token punctuation">.</span>geom<span class="token punctuation">,</span> <span class="token number">4326</span><span class="token punctuation">)</span> 
   :: geography<span class="token punctuation">,</span> <span class="token number">c</span><span class="token punctuation">.</span>geom<span class="token punctuation">)</span>
<span class="token keyword">where</span> <span class="token number">b</span><span class="token punctuation">.</span>carcinogen ilike <span class="token string">'YES'</span> 
  <span class="token operator">and</span> <span class="token number">a</span><span class="token punctuation">.</span>year <span class="token operator">=</span> <span class="token number">2018</span> 
  <span class="token operator">and</span> <span class="token number">a</span><span class="token punctuation">.</span>quantity <span class="token operator">between</span> <span class="token number">10000</span> <span class="token operator">and</span> <span class="token number">15000</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token number">a</span><span class="token punctuation">.</span>chemical<span class="token punctuation">,</span> 
  <span class="token number">a</span><span class="token punctuation">.</span>quantity<span class="token punctuation">,</span> 
  <span class="token number">a</span><span class="token punctuation">.</span>unit_of_measure<span class="token punctuation">,</span> 
  <span class="token number">d</span><span class="token punctuation">.</span>namelsad<span class="token punctuation">,</span> 
  <span class="token number">d</span><span class="token punctuation">.</span>geom<span class="token punctuation">,</span> 
  <span class="token number">c</span><span class="token punctuation">.</span>geom<span class="token punctuation">;</span>
</code></pre>
<p>RESULT:</p>
<pre class=" language-sql"><code class="prism  language-sql">chemical       <span class="token operator">|</span>quantity<span class="token operator">|</span>unit_of_measure<span class="token operator">|</span>namelsad           <span class="token operator">|</span>census_tract_geometries                                                                                                                                                                                                                                        <span class="token operator">|</span>tri_geometries              <span class="token operator">|</span>
<span class="token comment">---------------|--------|---------------|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|</span>
ACETALDEHYDE   <span class="token operator">|</span>   <span class="token number">12909</span><span class="token operator">|</span>Pounds         <span class="token operator">|</span>Census Tract <span class="token number">205.21</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76.87102399999999</span> <span class="token number">39.876773</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.870905</span> <span class="token number">39.87683</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.870548</span> <span class="token number">39.877005</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.87043</span> <span class="token number">39.877063</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.87030299999999</span> <span class="token number">39.877128</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.869924</span> <span class="token number">39.877326</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.869798</span> <span class="token number">39.877392</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.869754</span> <span class="token number">39.877846999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.870409</span> <span class="token number">39.879346999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.87058</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76.867315</span> <span class="token number">39.87159</span><span class="token punctuation">)</span> <span class="token operator">|</span>
ACETALDEHYDE   <span class="token operator">|</span>   <span class="token number">13314</span><span class="token operator">|</span>Pounds         <span class="token operator">|</span>Census Tract <span class="token number">9509</span>  <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76.52760099999999</span> <span class="token number">41.769757999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.527132</span> <span class="token number">41.781484</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.52694</span> <span class="token number">41.787002</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.526929</span> <span class="token number">41.787258</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.52689699999999</span> <span class="token number">41.788018</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.52689099999999</span> <span class="token number">41.788157999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.526893</span> <span class="token number">41.788312</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.526764</span> <span class="token number">41.791167</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.526709</span> <span class="token number">41.79120599</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76.42046</span> <span class="token number">41.76242</span><span class="token punctuation">)</span>  <span class="token operator">|</span>
DICHLOROMETHANE<span class="token operator">|</span>   <span class="token number">13152</span><span class="token operator">|</span>Pounds         <span class="token operator">|</span>Census Tract <span class="token number">3</span>     <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76.107387</span> <span class="token number">40.857152</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.09964599999999</span> <span class="token number">40.861514</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.099336</span> <span class="token number">40.861686999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.098406</span> <span class="token number">40.862204999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.098097</span> <span class="token number">40.862379</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.097808</span> <span class="token number">40.862539999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.09386599999999</span> <span class="token number">40.86479</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.086626</span> <span class="token number">40.868922999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.083141</span> <span class="token number">4</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76.024401</span> <span class="token number">40.834626</span><span class="token punctuation">)</span><span class="token operator">|</span>
DICHLOROMETHANE<span class="token operator">|</span>   <span class="token number">13407</span><span class="token operator">|</span>Pounds         <span class="token operator">|</span>Census Tract <span class="token number">807</span>   <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76.718696</span> <span class="token number">40.923052</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.71787599999999</span> <span class="token number">40.923742999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.715521</span> <span class="token number">40.925663</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.713977</span> <span class="token number">40.926699</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.713561</span> <span class="token number">40.926978999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.71274199999999</span> <span class="token number">40.927347999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.70985999999999</span> <span class="token number">40.928571999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">76.706893</span> <span class="token number">40.92939399999</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76.64329</span> <span class="token number">40.96131</span><span class="token punctuation">)</span>  <span class="token operator">|</span>
STYRENE        <span class="token operator">|</span>   <span class="token number">11517</span><span class="token operator">|</span>Pounds         <span class="token operator">|</span>Census Tract <span class="token number">4610</span>  <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80.16148</span> <span class="token number">40.523803</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.160349</span> <span class="token number">40.523426</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.160319</span> <span class="token number">40.523416</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.160191</span> <span class="token number">40.523379</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.159765</span> <span class="token number">40.523230999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.159154</span> <span class="token number">40.523081</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.157037</span> <span class="token number">40.522563</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.155788</span> <span class="token number">40.522348</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.154083</span> <span class="token number">40.522051999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.15395</span> <span class="token number">40.52202</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">.</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80.09127</span> <span class="token number">40.49761</span><span class="token punctuation">)</span>  <span class="token operator">|</span>
STYRENE        <span class="token operator">|</span>   <span class="token number">13176</span><span class="token operator">|</span>Pounds         <span class="token operator">|</span>Census Tract <span class="token number">9603</span>  <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.69867099999999</span> <span class="token number">40.161449999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.691099</span> <span class="token number">40.178796999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.69089</span> <span class="token number">40.179276</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.690428</span> <span class="token number">40.180336</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.689911</span> <span class="token number">40.181519</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.689865</span> <span class="token number">40.181625</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.689533</span> <span class="token number">40.182386</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.68782499999999</span> <span class="token number">40.186299</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.686781</span> <span class="token number">40.188691999999996</span><span class="token punctuation">,</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.61066</span> <span class="token number">40.18217</span><span class="token punctuation">)</span>  <span class="token operator">|</span>
</code></pre>
<p><img src="https://github.com/mckeonttemple/images/blob/gh-pages/SQ2_fullextent.png?raw=true" alt="enter image description here"><br>
<img src="https://github.com/mckeonttemple/images/blob/gh-pages/SQ2_zoomed.png?raw=true" alt="enter image description here"></p>
<p><strong>Spatial Query 3</strong>:<br>
<strong>For all years, identify the chemicals along with their corresponding census tracts that released greater than 4,500,000 pounds into water. Provide your answer in descending order.</strong></p>
<p>The third spatial query uses four tables: type, release, facility, and PA Census Tracts.   In this query,  we’re interested in the names of the chemicals which are emitted into water at over 4,500,000 pounds.  Remember to order the output in descending order and transform the geography to 4326.</p>
<pre class=" language-sql"><code class="prism  language-sql"><span class="token keyword">select</span> <span class="token number">a</span><span class="token punctuation">.</span>water <span class="token keyword">as</span> water_emission_lbs<span class="token punctuation">,</span> 
  <span class="token number">d</span><span class="token punctuation">.</span>namelsad<span class="token punctuation">,</span> 
  <span class="token number">b</span><span class="token punctuation">.</span>chemical <span class="token keyword">as</span> chemical_name<span class="token punctuation">,</span> 
  <span class="token number">c</span><span class="token punctuation">.</span>geom <span class="token keyword">as</span> TRI_Geometries<span class="token punctuation">,</span> 
  <span class="token number">d</span><span class="token punctuation">.</span>geom <span class="token keyword">as</span> Census_Tract_Geometries
<span class="token keyword">from</span> <span class="token keyword">type</span> <span class="token keyword">as</span> <span class="token number">a</span> 
<span class="token keyword">join</span> <span class="token keyword">release</span> <span class="token keyword">as</span> <span class="token number">b</span> 
  <span class="token keyword">on</span> <span class="token number">a</span><span class="token punctuation">.</span>release_id <span class="token operator">=</span> <span class="token number">b</span><span class="token punctuation">.</span>release_id 
<span class="token keyword">join</span> facility <span class="token keyword">as</span> <span class="token number">c</span> 
  <span class="token keyword">on</span> <span class="token number">b</span><span class="token punctuation">.</span>trifd <span class="token operator">=</span> <span class="token number">c</span><span class="token punctuation">.</span>trifd
<span class="token keyword">join</span>
   tl_2016_42_tract <span class="token keyword">as</span> <span class="token number">d</span>
   <span class="token keyword">on</span> ST_Intersects<span class="token punctuation">(</span>ST_Transform<span class="token punctuation">(</span><span class="token number">d</span><span class="token punctuation">.</span>geom<span class="token punctuation">,</span> <span class="token number">4326</span><span class="token punctuation">)</span> 
   :: geography<span class="token punctuation">,</span> <span class="token number">c</span><span class="token punctuation">.</span>geom<span class="token punctuation">)</span>
<span class="token keyword">where</span> <span class="token number">a</span><span class="token punctuation">.</span>water <span class="token operator">&gt;</span> <span class="token number">4500000</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">d</span><span class="token punctuation">.</span>namelsad<span class="token punctuation">,</span> <span class="token number">b</span><span class="token punctuation">.</span>chemical<span class="token punctuation">,</span> <span class="token number">a</span><span class="token punctuation">.</span>water <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre>
<p>RESULT:</p>
<pre class=" language-sql"><code class="prism  language-sql">water_emission_lbs<span class="token operator">|</span>namelsad          <span class="token operator">|</span>chemical_name                                      <span class="token operator">|</span>tri_geometries            <span class="token operator">|</span>census_tract_geometries                                                                                                                                                                                                                                        <span class="token operator">|</span>
<span class="token comment">------------------|------------------|---------------------------------------------------|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|</span>
         <span class="token number">6003084.0</span><span class="token operator">|</span>Census Tract <span class="token number">141</span>  <span class="token operator">|</span>SULFURIC ACID <span class="token punctuation">(</span><span class="token number">1994</span> <span class="token operator">AND</span> <span class="token keyword">AFTER</span> ACID AEROSOLS<span class="token string">" ONLY)"</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.2283</span> <span class="token number">40.69789</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.233419</span> <span class="token number">40.70308</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.2333</span> <span class="token number">40.703089999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.233083</span> <span class="token number">40.703122</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.231374</span> <span class="token number">40.703329</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.229438</span> <span class="token number">40.703564</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.225777</span> <span class="token number">40.704009</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.223604</span> <span class="token number">40.704263999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.223439</span> <span class="token number">40.704297</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.221284</span> <span class="token number">40.7046</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.221383</span> <span class="token number">40.705152</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.22</span><span class="token operator">|</span>
         <span class="token number">5000000.0</span><span class="token operator">|</span>Census Tract <span class="token number">60.02</span><span class="token operator">|</span>FORMIC ACID                                        <span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.54086</span> <span class="token number">40.63257</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.61489</span> <span class="token number">40.622836</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.61222099999999</span> <span class="token number">40.623872</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.61092</span> <span class="token number">40.624362999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.61022</span> <span class="token number">40.624635</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.60972</span> <span class="token number">40.624815</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.606764</span> <span class="token number">40.625946</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.604953</span> <span class="token number">40.626613</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.602297</span> <span class="token number">40.627615</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.601726</span> <span class="token number">40.627829999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">75.601531</span> <span class="token number">40.62790</span><span class="token operator">|</span>
             <span class="token number">3</span><span class="token punctuation">.</span>2E7<span class="token operator">|</span>Census Tract <span class="token number">9030</span> <span class="token operator">|</span>ZINC COMPOUNDS                                     <span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.94273</span> <span class="token number">40.82926</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.97237</span> <span class="token number">40.885918</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97213599999999</span> <span class="token number">40.885858999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971437</span> <span class="token number">40.885681999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971204</span> <span class="token number">40.885622999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971155</span> <span class="token number">40.88561</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97101099999999</span> <span class="token number">40.885571</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970963</span> <span class="token number">40.885559</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970928</span> <span class="token number">40.885549</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970824</span> <span class="token number">40.885521</span><span class="token punctuation">,</span> <span class="token operator">|</span>
             <span class="token number">3</span><span class="token punctuation">.</span>1E7<span class="token operator">|</span>Census Tract <span class="token number">9030</span> <span class="token operator">|</span>ZINC COMPOUNDS                                     <span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.94273</span> <span class="token number">40.82926</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.97237</span> <span class="token number">40.885918</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97213599999999</span> <span class="token number">40.885858999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971437</span> <span class="token number">40.885681999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971204</span> <span class="token number">40.885622999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971155</span> <span class="token number">40.88561</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97101099999999</span> <span class="token number">40.885571</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970963</span> <span class="token number">40.885559</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970928</span> <span class="token number">40.885549</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970824</span> <span class="token number">40.885521</span><span class="token punctuation">,</span> <span class="token operator">|</span>
             <span class="token number">2</span><span class="token punctuation">.</span>8E7<span class="token operator">|</span>Census Tract <span class="token number">9030</span> <span class="token operator">|</span>ZINC COMPOUNDS                                     <span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.94273</span> <span class="token number">40.82926</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.97237</span> <span class="token number">40.885918</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97213599999999</span> <span class="token number">40.885858999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971437</span> <span class="token number">40.885681999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971204</span> <span class="token number">40.885622999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971155</span> <span class="token number">40.88561</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97101099999999</span> <span class="token number">40.885571</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970963</span> <span class="token number">40.885559</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970928</span> <span class="token number">40.885549</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970824</span> <span class="token number">40.885521</span><span class="token punctuation">,</span> <span class="token operator">|</span>
             <span class="token number">2</span><span class="token punctuation">.</span>6E7<span class="token operator">|</span>Census Tract <span class="token number">9030</span> <span class="token operator">|</span>ZINC COMPOUNDS                                     <span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.94273</span> <span class="token number">40.82926</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.97237</span> <span class="token number">40.885918</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97213599999999</span> <span class="token number">40.885858999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971437</span> <span class="token number">40.885681999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971204</span> <span class="token number">40.885622999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971155</span> <span class="token number">40.88561</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97101099999999</span> <span class="token number">40.885571</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970963</span> <span class="token number">40.885559</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970928</span> <span class="token number">40.885549</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970824</span> <span class="token number">40.885521</span><span class="token punctuation">,</span> <span class="token operator">|</span>
             <span class="token number">1</span><span class="token punctuation">.</span>2E7<span class="token operator">|</span>Census Tract <span class="token number">9030</span> <span class="token operator">|</span>ZINC COMPOUNDS                                     <span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.94273</span> <span class="token number">40.82926</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.97237</span> <span class="token number">40.885918</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97213599999999</span> <span class="token number">40.885858999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971437</span> <span class="token number">40.885681999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971204</span> <span class="token number">40.885622999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971155</span> <span class="token number">40.88561</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97101099999999</span> <span class="token number">40.885571</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970963</span> <span class="token number">40.885559</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970928</span> <span class="token number">40.885549</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970824</span> <span class="token number">40.885521</span><span class="token punctuation">,</span> <span class="token operator">|</span>
         <span class="token number">9800000.0</span><span class="token operator">|</span>Census Tract <span class="token number">9030</span> <span class="token operator">|</span>ZINC COMPOUNDS                                     <span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.94273</span> <span class="token number">40.82926</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.97237</span> <span class="token number">40.885918</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97213599999999</span> <span class="token number">40.885858999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971437</span> <span class="token number">40.885681999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971204</span> <span class="token number">40.885622999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971155</span> <span class="token number">40.88561</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97101099999999</span> <span class="token number">40.885571</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970963</span> <span class="token number">40.885559</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970928</span> <span class="token number">40.885549</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970824</span> <span class="token number">40.885521</span><span class="token punctuation">,</span> <span class="token operator">|</span>
         <span class="token number">8400000.0</span><span class="token operator">|</span>Census Tract <span class="token number">9030</span> <span class="token operator">|</span>ZINC COMPOUNDS                                     <span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.94273</span> <span class="token number">40.82926</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.97237</span> <span class="token number">40.885918</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97213599999999</span> <span class="token number">40.885858999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971437</span> <span class="token number">40.885681999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971204</span> <span class="token number">40.885622999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.971155</span> <span class="token number">40.88561</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.97101099999999</span> <span class="token number">40.885571</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970963</span> <span class="token number">40.885559</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970928</span> <span class="token number">40.885549</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.970824</span> <span class="token number">40.885521</span><span class="token punctuation">,</span> <span class="token operator">|</span>
         <span class="token number">7560000.0</span><span class="token operator">|</span>Census Tract <span class="token number">9505</span> <span class="token operator">|</span>CATECHOL                                           <span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.67752</span> <span class="token number">41.49085</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.69776499999999</span> <span class="token number">41.502702</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.696818</span> <span class="token number">41.502686</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.69479</span> <span class="token number">41.502654</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.689028</span> <span class="token number">41.502576</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.688915</span> <span class="token number">41.502583</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.68880399999999</span> <span class="token number">41.502637</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.68856799999999</span> <span class="token number">41.502759</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.68838199999999</span> <span class="token number">41.502953</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.688046</span> <span class="token number">41.503229999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">|</span>
</code></pre>
<p><img src="https://github.com/mckeonttemple/images/blob/gh-pages/SQ3_fullextent.png?raw=true" alt="enter image description here"><br>
<img src="https://github.com/mckeonttemple/images/blob/gh-pages/SQ3_zoomed.png?raw=true" alt="enter image description here"></p>
<p><strong>Spatial Query 4</strong>:<br>
<strong>Perhaps you may be interested in knowing which  TRI emissions are near a census tract but do not actually fall within their geographic boundaries. Find the top five closest TRI emissions to each census tract, but limit to the top 5 census tracts with the farthest nearest neighbor. Report in meters and in descending order.</strong></p>
<p>This fourth spatial query uses a KNN operator ‘&lt;#&gt;’ to calculate the distance, of the nearest TRI emission to each census tract.  This query uses a cross lateral join, which allows rows from the census tract table to assume multiple values from the TRI emissions table.  In this join, we can set a limit  to identify the closest 5 TRI emissions to each census tract, rather than generate a list of distances of ALL emissions to ALL census tracts, which would have been a time-intensive and massive query.  This query was then further refined to limit to the 5 “farthest” nearest neighbors.</p>
<pre class=" language-sql"><code class="prism  language-sql"><span class="token keyword">select</span> <span class="token number">a</span><span class="token punctuation">.</span>trifd<span class="token punctuation">,</span> <span class="token number">c</span><span class="token punctuation">.</span>namelsad<span class="token punctuation">,</span>
  ST_Distance<span class="token punctuation">(</span>ST_Transform<span class="token punctuation">(</span><span class="token number">c</span><span class="token punctuation">.</span>geom<span class="token punctuation">,</span> <span class="token number">4326</span><span class="token punctuation">)</span> 
    :: geography<span class="token punctuation">,</span> <span class="token number">a</span><span class="token punctuation">.</span>geom<span class="token punctuation">)</span> <span class="token keyword">as</span> Distance_in_Meters<span class="token punctuation">,</span> 
  <span class="token number">c</span><span class="token punctuation">.</span>geom <span class="token keyword">as</span> Census_Tract_Geometries<span class="token punctuation">,</span>
  <span class="token number">a</span><span class="token punctuation">.</span>geom <span class="token keyword">as</span> TRI_Geometries
<span class="token keyword">from</span> facility <span class="token keyword">as</span> <span class="token number">a</span> 
<span class="token keyword">cross</span> <span class="token keyword">join</span> lateral 
  <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">b</span><span class="token punctuation">.</span>namelsad<span class="token punctuation">,</span> <span class="token number">b</span><span class="token punctuation">.</span>geom
    <span class="token keyword">from</span> tl_2016_42_tract <span class="token keyword">as</span> <span class="token number">b</span> 
    <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">b</span><span class="token punctuation">.</span>geom <span class="token operator">&lt;</span><span class="token comment">#&gt; a.geom limit 5) as c</span>
 <span class="token keyword">order</span> <span class="token keyword">by</span> Distance_in_Meters <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">5</span><span class="token punctuation">;</span>  
</code></pre>
<p>RESULT:</p>
<pre class=" language-sql"><code class="prism  language-sql">trifd          <span class="token operator">|</span>namelsad         <span class="token operator">|</span>distance_in_meters<span class="token operator">|</span>census_tract_geometries                                                                                                                                                                                                                                        <span class="token operator">|</span>tri_geometries              <span class="token operator">|</span>
<span class="token comment">---------------|-----------------|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|</span>
16923HRBRTGOLDR<span class="token operator">|</span>Census Tract <span class="token number">9504</span><span class="token operator">|</span>    <span class="token number">26363.68680118</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.205353</span> <span class="token number">41.818427</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.202683</span> <span class="token number">41.818385</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.19608</span> <span class="token number">41.818284</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.19467499999999</span> <span class="token number">41.818262</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.19200599999999</span> <span class="token number">41.818221</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.191801</span> <span class="token number">41.818217</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.191186</span> <span class="token number">41.818207</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.190981</span> <span class="token number">41.818204</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.190771</span> <span class="token number">41.818200999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.190141</span> <span class="token number">41.818</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">77.86718</span> <span class="token number">41.98474</span><span class="token punctuation">)</span>  <span class="token operator">|</span>
16825BRDFRMCDOW<span class="token operator">|</span>Census Tract <span class="token number">105</span> <span class="token operator">|</span>    <span class="token number">24821.18701032</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.282781</span> <span class="token number">40.73641</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.281764</span> <span class="token number">40.737044</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.279426</span> <span class="token number">40.738313999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.279101</span> <span class="token number">40.738519</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.27499499999999</span> <span class="token number">40.740721</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.272792</span> <span class="token number">40.741918</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.271352</span> <span class="token number">40.742701</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.25218</span> <span class="token number">40.753116</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.251632</span> <span class="token number">40.753414</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.24792</span> <span class="token number">40.75543</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.24</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.299167</span> <span class="token number">41.003611</span><span class="token punctuation">)</span><span class="token operator">|</span>
15501PBSQC10310<span class="token operator">|</span>Census Tract <span class="token number">213</span> <span class="token operator">|</span>     <span class="token number">23488.2263498</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.05595799999999</span> <span class="token number">39.723422</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.053146</span> <span class="token number">39.72607</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.05188299999999</span> <span class="token number">39.727270999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.050102</span> <span class="token number">39.728967</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.04955799999999</span> <span class="token number">39.729465999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.049095</span> <span class="token number">39.729917</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.049042</span> <span class="token number">39.729952999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">79.04901199999999</span> <span class="token number">39.7299889999999</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">79.080029</span> <span class="token number">40.086465</span><span class="token punctuation">)</span><span class="token operator">|</span>
16825GLNGRBOX33<span class="token operator">|</span>Census Tract <span class="token number">105</span> <span class="token operator">|</span>    <span class="token number">23373.90045074</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.282781</span> <span class="token number">40.73641</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.281764</span> <span class="token number">40.737044</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.279426</span> <span class="token number">40.738313999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.279101</span> <span class="token number">40.738519</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.27499499999999</span> <span class="token number">40.740721</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.272792</span> <span class="token number">40.741918</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.271352</span> <span class="token number">40.742701</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.25218</span> <span class="token number">40.753116</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.251632</span> <span class="token number">40.753414</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.24792</span> <span class="token number">40.75543</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.24</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.31019</span> <span class="token number">40.98099</span><span class="token punctuation">)</span>  <span class="token operator">|</span>
16915LHLNC203CH<span class="token operator">|</span>Census Tract <span class="token number">9602</span><span class="token operator">|</span>    <span class="token number">22350.41555333</span><span class="token operator">|</span><span class="token keyword">MULTIPOLYGON</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.420968</span> <span class="token number">41.478232999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.42092</span> <span class="token number">41.479676</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.42088799999999</span> <span class="token number">41.480458999999996</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.42070199999999</span> <span class="token number">41.485188</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.420653</span> <span class="token number">41.486402</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.420625</span> <span class="token number">41.487138</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.42062399999999</span> <span class="token number">41.487178</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.420622</span> <span class="token number">41.487227999999995</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">78.420591</span> <span class="token number">41</span><span class="token operator">|</span><span class="token keyword">POINT</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78.02423</span> <span class="token number">41.76801</span><span class="token punctuation">)</span>  <span class="token operator">|</span>
</code></pre>
<p><img src="https://github.com/mckeonttemple/images/blob/gh-pages/SQ4_fullextent.png?raw=true" alt="enter image description here"><br>
<img src="https://github.com/mckeonttemple/images/blob/gh-pages/SQ4_zoomed.png?raw=true" alt="enter image description here"></p>
<h2 id="improving-query-optimization">Improving Query Optimization</h2>
<p>Fortunately, these datasets are relatively small in the cosmic universe of spatial information. However, you may encounter datasets with hundreds of millions of rows, or you may ask complicated queries which take a lot of computing power to read and write operations. The KNN operator for the fourth query could generate a massive output if no limits were set.  To optimize you may want to  construct an index or denormalize the data.  If you find that the time it takes to execute a query takes a long time ( could be minutes), then you may want to create an index or denormalize.</p>
<h3 id="index-construction">Index Construction</h3>
<p>There are tools available online like SQL Profiler  which can help you identify queries which are peforming at suboptimal levels:</p>
<blockquote>
<p><a href="https://www.sqlmvp.org/sql-server-profiler-trace/">https://www.sqlmvp.org/sql-server-profiler-trace/</a></p>
</blockquote>
<p>Either way,  an index allows a query to search data quickly by searching part of a table rather than the entire dataset.  Try constructing an index using the following format:</p>
<pre class=" language-sql"><code class="prism  language-sql"><span class="token keyword">create</span> <span class="token keyword">index</span> index_name 
<span class="token keyword">on</span> table_name<span class="token punctuation">(</span>column_to_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="denormalization">Denormalization</h3>
<p>The ERD shown earlier shows how the TRI data have been normalized into five tables. The purpose of this is to reduce redundancy and eliminate deletion and insertion errors.  However you may want to minimize invoking several joins to get to a certain attribute. You may have noticed that the geom is only found in the facility table. You may not want to always include the facility table in your queries. However at the moment, you cannot avoid joining to it if you want to access the geom. Go ahead and try adding the GEOM field to the other four TRI tables, then get on out there and create some new queries!</p>
<h5 id="how-about-exploring-the-toxic-release-inventory-through-leaflet.js-httpsmckeonttemple.github.iodraft_tri">How about exploring the Toxic Release Inventory through Leaflet.js: <a href="https://mckeonttemple.github.io/Draft_tri/">https://mckeonttemple.github.io/Draft_tri/</a></h5>
<h2 id="i-hope-you-enjoyed-this-tutorial">I hope you enjoyed this tutorial!</h2>
<p>Thomas P. McKeon</p>
<p>Doctoral Student<br>
Geography  and  Urban  Studies<br>
Temple University</p>
<p>MPH - Environmental Health '18<br>
Perelman School of Medicine<br>
University of Pennsylvania</p>
<p>B.S. - Ecology and Natural Resources  '11<br>
Rutgers University–<em>New Brunswick</em></p>
<h5 id="how-about-exploring-the-toxic-release-inventory-through-leaflet.js-httpsmckeonttemple.github.iodraft_tri-1">How about exploring the Toxic Release Inventory through Leaflet.js: <a href="https://mckeonttemple.github.io/Draft_tri/">https://mckeonttemple.github.io/Draft_tri/</a></h5>
</div>
</body>

</html>
